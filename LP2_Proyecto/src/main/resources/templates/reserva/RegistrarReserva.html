<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Registrar Reserva - Horizon Luxe</title>
    <link rel="stylesheet" th:href="@{/styles/reserva.css}">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        script[type="application/json"] {
            display: none !important;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="logo">
            <img src="@{/imgs/horizon_luxe_logo.jpeg}" alt="Horizon Luxe Paris" th:src="@{/imgs/horizon_luxe_logo.jpeg}">
        </div>
        <h1>Registrar Nueva Reserva</h1>
    </div>

    <div class="main-content">

        <div th:if="${mensaje}" class="message success">
            <p th:text="${mensaje}"></p>
        </div>
        <div th:if="${error}" class="message error">
            <p th:text="${error}"></p>
        </div>

        <form th:action="@{/reservas/registrar}" method="post" th:object="${reservaDto}" class="form-section">
            <div class="form-grid">
                <div class="form-group">
                    <label for="nroReserva">Número de Reserva:</label>
                    <input type="text" id="nroReserva" th:field="*{nroReserva}" readonly />
                </div>

                <div class="form-group">
                    <label for="buscadorCliente">Cliente:</label>
                    <input type="text" id="buscadorCliente" placeholder="Ingrese nombre, apellido o DNI" class="form-control" autocomplete="off">
                    <input type="hidden" th:field="*{clienteId}" id="clienteId">
                    <div id="resultadoClientes" class="autocomplete-list"></div>
                    <div class="error" th:if="${#fields.hasErrors('clienteId')}" th:errors="*{clienteId}"></div>
                </div>

                <div class="form-group">
                    <label for="habitacionId">Habitación Seleccionada:</label>
                    <input type="text" id="habitacionInput" placeholder="Seleccione una habitación" readonly class="form-control">
                    <input type="hidden" th:field="*{habitacionId}" id="habitacionId">
                    <button type="button" class="btn btn-primary" onclick="abrirModalHabitaciones()">Seleccionar Habitación</button>
                </div>

                <div class="form-group">
                    <label for="fechaInicio">Fecha Inicio:</label>
                    <input type="date" th:field="*{fechaInicio}" required>
                    <div class="error" th:if="${#fields.hasErrors('fechaInicio')}" th:errors="*{fechaInicio}"></div>
                </div>

                <div class="form-group">
                    <label for="fechaFin">Fecha Fin:</label>
                    <input type="date" th:field="*{fechaFin}" required>
                    <div class="error" th:if="${#fields.hasErrors('fechaFin')}" th:errors="*{fechaFin}"></div>
                    <div class="error" th:if="${#fields.hasGlobalErrors()}" th:each="err : ${#fields.globalErrors()}" th:text="${err}"></div>
                </div>
            </div>

            <div class="buttons">
                <a th:href="@{/}" class="btn btn-secondary">🔙 Volver</a>
                <button type="submit" class="btn btn-primary">💾 Registrar Reserva</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal habitaciones -->
<div id="modalHabitaciones" class="modal">
    <div class="modal-content">
        <span class="close" onclick="cerrarModalHabitaciones()">&times;</span>
        <h3>Seleccione una habitación</h3>
        <div class="habitaciones-container">
            <div class="habitacion-card" 
                 th:each="hab : ${habitacionesDisponibles}" 
                 th:data-id="${hab.id}"
                 th:data-numero="${hab.numero}"
                 th:data-descripcion="${hab.tipo.descripcion}"
                 onclick="seleccionarHabitacionModal(this)">
                <h4 th:text="'N° ' + ${hab.numero}"></h4>
                <p th:text="${hab.tipo.descripcion}"></p>
            </div>
        </div>
    </div>
</div>

<!-- Cliente JSON en formato oculto -->
<script id="clientesData" type="application/json" th:inline="javascript">
    [[${clientes}]]
</script>

<!-- JS funcionalidad -->
<script th:src="@{/js/reserva.js}"></script>
</body>
</html>
